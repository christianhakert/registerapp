#include "data.h"

uint64_t tuple_size = sizeof(uint64_t) * ATTRIBUTE_COUNT;

int main() {
	uint64_t* tuple_base = &tuples[0][0];
	uint64_t* result_base = &results[0][0];

	__asm__ __volatile__ (
		"mov x0, %[tuple_base]\n"
		"mov x1, %[result_base]\n"
		""
		"# Loop over the tuples\n"
		"mov x2, #0\n"
		"mov x3, %[tuple_count]\n"
		"# Clean registers\n"
		"mov x5, #0\n"
		"mov x6, #0\n"
		"mov x7, #0\n"
		"mov x8, #0\n"
		"mov x9, #0\n"
		"mov x10, #0\n"
		"mov x11, #0\n"
		"mov x12, #0\n"
		"mov x13, #0\n"
		"mov x14, #0\n"
		"mov x15, #0\n"
		"mov x16, #0\n"
		"mov x17, #0\n"
		"mov x18, #0\n"
		"mov x19, #0\n"
		"mov x20, #0\n"
		"mov x21, #0\n"
		"mov x22, #0\n"
		"mov x23, #0\n"
		"mov x24, #0\n"
		""
		"loop_start:\n"
		"cmp x2, x3\n"
		"b.gt loop_end\n"
		""
		"# load attribute 0 in x4 from x0 + 0 and store it\n"
		"ldr x4, [x0, #0]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #0]\n"
		"# load attribute 1 in x4 from x0 + 8 and store it\n"
		"ldr x4, [x0, #8]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #8]\n"
		"# load attribute 2 in x4 from x0 + 16 and store it\n"
		"ldr x4, [x0, #16]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #16]\n"
		"# load attribute 3 in x4 from x0 + 24 and store it\n"
		"ldr x4, [x0, #24]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #24]\n"
		"# load attribute 4 in x4 from x0 + 32 and store it\n"
		"ldr x4, [x0, #32]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #32]\n"
		"# load attribute 5 in x4 from x0 + 40 and store it\n"
		"ldr x4, [x0, #40]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #40]\n"
		"# load attribute 6 in x4 from x0 + 48 and store it\n"
		"ldr x4, [x0, #48]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #48]\n"
		"# load attribute 7 in x4 from x0 + 56 and store it\n"
		"ldr x4, [x0, #56]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #56]\n"
		"# load attribute 8 in x4 from x0 + 64 and store it\n"
		"ldr x4, [x0, #64]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #64]\n"
		"# load attribute 9 in x4 from x0 + 72 and store it\n"
		"ldr x4, [x0, #72]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #72]\n"
		"# load attribute 10 in x4 from x0 + 80 and store it\n"
		"ldr x4, [x0, #80]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #80]\n"
		"# load attribute 11 in x4 from x0 + 88 and store it\n"
		"ldr x4, [x0, #88]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #88]\n"
		"# load attribute 12 in x4 from x0 + 96 and store it\n"
		"ldr x4, [x0, #96]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #96]\n"
		"# load attribute 13 in x4 from x0 + 104 and store it\n"
		"ldr x4, [x0, #104]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #104]\n"
		"# load attribute 14 in x4 from x0 + 112 and store it\n"
		"ldr x4, [x0, #112]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #112]\n"
		"# load attribute 15 in x4 from x0 + 120 and store it\n"
		"ldr x4, [x0, #120]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #120]\n"
		"# load attribute 16 in x4 from x0 + 128 and store it\n"
		"ldr x4, [x0, #128]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #128]\n"
		"# load attribute 17 in x4 from x0 + 136 and store it\n"
		"ldr x4, [x0, #136]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #136]\n"
		"# load attribute 18 in x4 from x0 + 144 and store it\n"
		"ldr x4, [x0, #144]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #144]\n"
		"# load attribute 19 in x4 from x0 + 152 and store it\n"
		"ldr x4, [x0, #152]\n"
		"add x4, x4, #1\n"
		"str x4, [x0, #152]\n"
		""
		""
		"# Aggregate (Sum) on attribute 0\n"
		"ldr x4, [x0, #0]\n"
		"add x5, x5, x4\n"
		""
		"# Aggregate (Sum) on attribute 1\n"
		"ldr x4, [x0, #8]\n"
		"add x6, x6, x4\n"
		""
		"# Aggregate (Sum) on attribute 2\n"
		"ldr x4, [x0, #16]\n"
		"add x7, x7, x4\n"
		""
		"# Aggregate (Sum) on attribute 3\n"
		"ldr x4, [x0, #24]\n"
		"add x8, x8, x4\n"
		""
		"# Aggregate (Sum) on attribute 4\n"
		"ldr x4, [x0, #32]\n"
		"add x9, x9, x4\n"
		""
		"# Aggregate (Sum) on attribute 5\n"
		"ldr x4, [x0, #40]\n"
		"add x10, x10, x4\n"
		""
		"# Aggregate (Sum) on attribute 6\n"
		"ldr x4, [x0, #48]\n"
		"add x11, x11, x4\n"
		""
		"# Aggregate (Sum) on attribute 7\n"
		"ldr x4, [x0, #56]\n"
		"add x12, x12, x4\n"
		""
		"# Aggregate (Sum) on attribute 8\n"
		"ldr x4, [x0, #64]\n"
		"add x13, x13, x4\n"
		""
		"# Aggregate (Sum) on attribute 9\n"
		"ldr x4, [x0, #72]\n"
		"add x14, x14, x4\n"
		""
		"# Aggregate (Sum) on attribute 10\n"
		"ldr x4, [x0, #80]\n"
		"add x15, x15, x4\n"
		""
		"# Aggregate (Sum) on attribute 11\n"
		"ldr x4, [x0, #88]\n"
		"add x16, x16, x4\n"
		""
		"# Aggregate (Sum) on attribute 12\n"
		"ldr x4, [x0, #96]\n"
		"add x17, x17, x4\n"
		""
		"# Aggregate (Sum) on attribute 13\n"
		"ldr x4, [x0, #104]\n"
		"add x18, x18, x4\n"
		""
		"# Aggregate (Sum) on attribute 14\n"
		"ldr x4, [x0, #112]\n"
		"add x19, x19, x4\n"
		""
		"# Aggregate (Sum) on attribute 15\n"
		"ldr x4, [x0, #120]\n"
		"add x20, x20, x4\n"
		""
		"# Aggregate (Sum) on attribute 16\n"
		"ldr x4, [x0, #128]\n"
		"add x21, x21, x4\n"
		""
		"# Aggregate (Sum) on attribute 17\n"
		"ldr x4, [x0, #136]\n"
		"add x22, x22, x4\n"
		""
		"# Aggregate (Sum) on attribute 18\n"
		"ldr x4, [x0, #144]\n"
		"add x23, x23, x4\n"
		""
		"# Aggregate (Sum) on attribute 19\n"
		"ldr x4, [x0, #152]\n"
		"add x24, x24, x4\n"
		""
		""
		"# End of the loop over the tuples\n"
		"increase_loop_counter:\n"
		"add x0, x0, #160\n"
		"add x2, x2, #1\n"
		"b loop_start\n"
		"loop_end:\n"
		""
		"# If aggregation write the aggregated results to result_base\n"
		"str x5, [x1, #0]\n"
		"str x6, [x1, #8]\n"
		"str x7, [x1, #16]\n"
		"str x8, [x1, #24]\n"
		"str x9, [x1, #32]\n"
		"str x10, [x1, #40]\n"
		"str x11, [x1, #48]\n"
		"str x12, [x1, #56]\n"
		"str x13, [x1, #64]\n"
		"str x14, [x1, #72]\n"
		"str x15, [x1, #80]\n"
		"str x16, [x1, #88]\n"
		"str x17, [x1, #96]\n"
		"str x18, [x1, #104]\n"
		"str x19, [x1, #112]\n"
		"str x20, [x1, #120]\n"
		"str x21, [x1, #128]\n"
		"str x22, [x1, #136]\n"
		"str x23, [x1, #144]\n"
		"str x24, [x1, #152]\n"
	:
	: [tuple_base] "r" (tuple_base), [result_base] "r" (result_base), [tuple_count] "r" (TUPLE_COUNT)
	: "x0","x1","x2","x3","x4","x5","x6","x7","x8","x9","x10","x11","x12","x13","x14","x15","x16","x17","x18","x19","x20","x21","x22","x23","x24", "memory");

	for (int i = 0; i < 1; i++) {
		printf("result_attribute0 = %lu, result_attribute1 = %lu, result_attribute2 = %lu, result_attribute3 = %lu, result_attribute4 = %lu, result_attribute5 = %lu, result_attribute6 = %lu, result_attribute7 = %lu, result_attribute8 = %lu, result_attribute9 = %lu, result_attribute10 = %lu, result_attribute11 = %lu, result_attribute12 = %lu, result_attribute13 = %lu, result_attribute14 = %lu, result_attribute15 = %lu, result_attribute16 = %lu, result_attribute17 = %lu, result_attribute18 = %lu, result_attribute19 = %lu\n", results[i][0],results[i][1],results[i][2],results[i][3],results[i][4],results[i][5],results[i][6],results[i][7],results[i][8],results[i][9],results[i][10],results[i][11],results[i][12],results[i][13],results[i][14],results[i][15],results[i][16],results[i][17],results[i][18],results[i][19]);

	}

	return 0;
}